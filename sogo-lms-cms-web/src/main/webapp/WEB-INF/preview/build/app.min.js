var appPreview=angular.module("app.preview",["ngSanitize"]);appPreview.filter("genVideoTag",["$sce",function(e){return function(c){if(c)return e.trustAsHtml(c)}}]);appPreview.filter("activityTime",function(){return function(e){if(""!==e&&e){var c=new Date(1970,0,1);c.setMinutes(1*e.toString().match(/\d+/)[0]);return moment(c).format("mm")}return e}});
(function(){angular.module("app.preview").controller("Catalouge.Preview",["$scope","$rootScope","$q","$timeout","$sce","previewService",function(e,c,d,g,l,h){var a=this;a.activityTypeId=0;a.isDoneQuiz=!1;a.getActivityTemplate=function(a){var b="";switch(a){case 1:b="/views/preview/activity_QA.html";break;case 2:b="/views/preview/activity_text.html";break;case 3:b="/views/preview/activity_video.html";break;case 4:b="/views/preview/activity_quiz.html"}return b};a.getQuizAnswerTemplate=function(a,f){var b=
"";switch(a){case 1:case 4:b="/views/preview/quiz_multi.html?v\x3d"+f;break;case 3:b="/views/preview/quiz_single.html?v\x3d"+f;break;case 5:b="/views/preview/quiz_text.html?v\x3d"+f}return b};a.finishLoadingQuizAnswer=function(){g(function(){componentHandler.upgradeElements(document.querySelector("#dActivityInfo"))},1)};a.computeActivityTimeClass=function(b,f,m,c){var d="",e=0;angular.forEach(a.listActivity,function(b,f){b.activityId==a.activityId&&(e=f)});d=f?"bg_first":m?"bg_last":"bg_middle";c.activityId==
a.activityId?d+=" active":c.activityId==a.lastDoneActivityId?d+=" last-active":b<e&&(d+=" past");return d};var n=function(b){var f=d.defer();h.getActivityDetails(b).then(function(b){a.activityDetails=b.data;f.resolve()});return f.promise},p=function(b,f){var c=d.defer();h.getActivityCatalouge({unitId:b,lessonId:f}).then(function(b){a.listActivity=b.data;c.resolve()});return c.promise};e.init=function(b,f,c){d.all([n(c),p(b,f)]).then(function(){a.activityTypeId=a.activityDetails.activityTypeId;a.activityId=
c;4==a.activityTypeId&&h.getQuizQuestion(a.activityId).then(function(b){a.listQuestion=b.data;a.listQuestion&&0<a.listQuestion.length&&(a.currentQuizQuestion=a.listQuestion[0],a.currentQuizIndex=0)})})};a.computeQuestionPagingClass=function(b,c){b="";c.questionId==a.currentQuizQuestion.questionId?b="active":c.isTraineeAnswerRight?b="past ok":void 0==c.isTraineeAnswerRight||c.isTraineeAnswerRight||(b="past error");return b};a.isShowPaging=function(b){return 0==a.currentQuizIndex&&b<=a.currentQuizIndex+
2||1==a.currentQuizIndex&&1==a.currentQuizIndex%2&&b<=a.currentQuizIndex+1&&b>=a.currentQuizIndex-1||1<a.currentQuizIndex&&b<=a.currentQuizIndex&&b>=a.currentQuizIndex-2||a.currentQuizIndex+1==a.listQuestion.length-1&&b>=a.currentQuizIndex-3||a.currentQuizIndex==a.listQuestion.length-1&&b>=a.currentQuizIndex-4||b==a.listQuestion.length-1};a.isHidePaging=function(b){return!a.isShowPaging(b)&&5<a.listQuestion.length&&b+1==a.listQuestion.length-1};a.nextQuizQuestion=function(){a.traineeAnswerErrorText=
"";var b=0<Enumerable.From(a.currentQuizQuestion.listAnswer).Count(function(a){return a.isChecked}),c=Enumerable.From(a.currentQuizQuestion.listAnswer).Where(function(a){return a.isChecked}).ToArray(),d=a.currentQuizQuestion.questionTypeId;if(1!=d&&4!=d||b)if(3!=d||a.currentQuizQuestion.traineeAnswer)if(5!=d||a.currentQuizQuestion.traineeAnswer)if(5==d&&2E3<a.currentQuizQuestion.traineeAnswer.length)a.traineeAnswerErrorText="Sorry, your answer is too long (max: 2000 characters)";else{var b=a.currentQuizQuestion.rightAnswerIndex,
e=!1;if(1==d||4==d){var g=!0,h=b.split(","),k="";angular.forEach(c,function(a){k+=(""!=k?",":"")+a.answerIndex.toString();-1==h.indexOf(a.answerIndex.toString())&&(g=!1)});g&&(g=c.length==h.length);Enumerable.From(a.listQuestion).First(function(b){return b.questionId==a.currentQuizQuestion.questionId}).isTraineeAnswerRight=g;Enumerable.From(a.listQuestion).First(function(b){return b.questionId==a.currentQuizQuestion.questionId}).traineeAnswer=k;e=g}else 3==d?(e=a.currentQuizQuestion.traineeAnswer==
b,Enumerable.From(a.listQuestion).First(function(b){return b.questionId==a.currentQuizQuestion.questionId}).isTraineeAnswerRight=e):5==d&&(Enumerable.From(a.listQuestion).First(function(b){return b.questionId==a.currentQuizQuestion.questionId}).isTraineeAnswerRight=!0);!a.isRedoingQiz&&a.currentQuizIndex+1<=a.listQuestion.length-1?(a.answerLoaded=!1,a.isLastQuizQuestion=a.currentQuizIndex+1==a.listQuestion.length-1,a.currentQuizIndex+=1,a.currentQuizQuestion=a.listQuestion[a.currentQuizIndex]):a.isRedoingQiz&&
!e?a.traineeAnswerErrorText="Sorry, this is not correct":a.isRedoingQiz&&e&&a.currentErrorQuizIndex+1<=a.errorQuestion.length-1?(a.currentErrorQuizIndex+=1,a.currentQuizQuestion=a.errorQuestion[a.currentErrorQuizIndex],a.currentQuizIndex=a.listQuestion.indexOf(a.currentQuizQuestion),a.currentQuizType=3==a.currentQuizQuestion.questionTypeId?"radio":"checkbox",a.isLastQuizQuestion=a.currentQuizIndex==a.listQuestion.length-1):(a.currentQuizIndex=a.listQuestion.length-1,c=0<Enumerable.From(a.listQuestion).Count(function(a){return!a.isTraineeAnswerRight}),
a.isRedoingQiz||Enumerable.From(a.listQuestion).Select("x \x3d\x3e { questionId: x['questionId'], traineeAnswer: x['traineeAnswer'].toString() , isTraineeAnswerRight: x['isTraineeAnswerRight'] }").ToArray(),a.isDoneQuiz=!0,a.hasErrorQuiz=c)}else a.traineeAnswerErrorText="Please provide an answer";else a.traineeAnswerErrorText="Please choose an answer";else a.traineeAnswerErrorText="Please choose an answer"};a.redoQuiz=function(){a.isRedoingQiz=!0;a.isDoneQuiz=!1;a.errorQuestion=Enumerable.From(a.listQuestion).Where(function(a){return!a.isTraineeAnswerRight}).ToArray();
a.currentErrorQuizIndex=0;a.currentQuizQuestion=a.errorQuestion[0];a.currentQuizIndex=a.listQuestion.indexOf(a.currentQuizQuestion);a.currentQuizType=3==a.currentQuizQuestion.questionTypeId?"radio":"checkbox";a.isLastQuizQuestion=a.currentQuizIndex==a.listQuestion.length-1};a.processingActivityData=function(a){a=a.replace(/href/g,'target\x3d"_blank" href');return l.trustAsHtml(a)};a.genVideoTag=function(a){return l.trustAsHtml(a)}}])})();
(function(){angular.module("app.preview").service("baseService",["$http",function(e){this.baseUrl="/api";this.getData=function(c,d){return e.get(c,{params:d}).then(function(c){return c.data})};this.postData=function(c,d){return e.post(c,d).then(function(c){return c.data})}}])})();
(function(){angular.module("app.preview").service("previewService",["$http","baseService",function(e,c){this.getActivityDetails=function(d){return c.postData(c.baseUrl+"/catalouge/getActivityDetails",d)};this.getQuizQuestion=function(d){return c.postData(c.baseUrl+"/catalouge/getQuizQuestion",d)};this.getActivityCatalouge=function(d){return c.postData(c.baseUrl+"/catalouge/getActivityCatalouge",d)}}])})();